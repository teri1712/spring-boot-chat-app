version: '3.8'

services:
    server:
        #        image: teri1712/decade-chat-app:latest
        build:
            context: .
            dockerfile: Dockerfile
        env_file:
            - ./.env
        ports:
            - "8080:8080"
            - "8081:8081"
        depends_on:
            mysql:
                condition: service_healthy
            redis:
                condition: service_healthy

    mysql:
        image: mysql:8.0
        env_file:
            - ./.env
        ports:
            - "3306:3306"
        healthcheck:
            test: [ "CMD-SHELL", "mysqladmin ping -h 127.0.0.1 -uroot -proot || exit 1" ]
            interval: 5s
            timeout: 3s
            retries: 20
            start_period: 10s

    redis:
        image: redis/redis-stack:latest
        ports:
            - "6379:6379"
            - "8001:8001"
        healthcheck:
            test: [ "CMD", "redis-cli", "ping" ]
            interval: 5s
            timeout: 3s
            retries: 20
            start_period: 5s

    monitor:
        image: teri1712/monitor:latest
        env_file:
            - ./.env
        ports:
            - "9090:9090"
